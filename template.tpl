___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Kapchura tracker",
  "categories": ["LEAD_GENERATION", "MARKETING"],
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC8AAAAoCAYAAABuIqMUAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAaGVYSWZNTQAqAAAACAAEAQYAAwAAAAEAAgAAARIAAwAAAAEAAQAAASgAAwAAAAEAAgAAh2kABAAAAAEAAAA+AAAAAAADoAEAAwAAAAEAAQAAoAIABAAAAAEAAAAvoAMABAAAAAEAAAAoAAAAANiLn9wAAALiaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA2LjAuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIgogICAgICAgICAgICB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyI+CiAgICAgICAgIDx0aWZmOkNvbXByZXNzaW9uPjE8L3RpZmY6Q29tcHJlc3Npb24+CiAgICAgICAgIDx0aWZmOlJlc29sdXRpb25Vbml0PjI8L3RpZmY6UmVzb2x1dGlvblVuaXQ+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgICAgIDx0aWZmOlBob3RvbWV0cmljSW50ZXJwcmV0YXRpb24+MjwvdGlmZjpQaG90b21ldHJpY0ludGVycHJldGF0aW9uPgogICAgICAgICA8ZXhpZjpQaXhlbFhEaW1lbnNpb24+NDc8L2V4aWY6UGl4ZWxYRGltZW5zaW9uPgogICAgICAgICA8ZXhpZjpDb2xvclNwYWNlPjE8L2V4aWY6Q29sb3JTcGFjZT4KICAgICAgICAgPGV4aWY6UGl4ZWxZRGltZW5zaW9uPjQwPC9leGlmOlBpeGVsWURpbWVuc2lvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CvOlxssAAAg2SURBVFgJxVlrbFTHFZ772AVje70BShzAxkZRSE0UqUrTKlHoS6WkRZWqpKX/KlWqqrZSVVL/60OKmv4rClH/VKryPyVUan+lkChtRRMCihAhCY88seMltY3B6921vezj3n7fOXfuvV52U2KwGTN3Zs6cx3fOnJk7d3FMSynV6w8dmvrgqVeKl0fOzc/lTOhkC9UF1xiH1ThowjB00IPk0iq0kAojuuOGhmPHCZ2ArRug3wStjkEV/dLWtV3TfZ7/3pY16/75lU0bDv+gv3+eGm6k0Epcnp/68Nhv3ju9q9SoEyboWh1ABV4Zq0AyZ3nYOmngLfIIQmTH6oFOyqT4wBAOrO26un9o4Lnv9d/5C9ilyx2L1WgOXHzznQPjZ+8REEsUWpbEqAVMwwQQy3QCL+aVz8rGMrEtMiW6nhgerOzftvVLcOC0iLd5+KT9BRHff/6kALcKklbNXB+l/w9co0oLnwSc8ywJcPYPXiz09Hr+K0jR3k4r4Ewslr/82Jl//XuiuoAUhIIoPR7Of8bs2bDF5PxMPZ/JTua8zEfQOQ6OggndKSTzDOAXm8aUPddZcAOv6gRBI/CbtWYYBibMNhQUcTl+6Lq+22yuQx7kPcfZFAbB9nKzOVJqND8/Ub12z18nL7uF6rXYCTqQ833z6hfv/1NfNvuzWFeq4x8vXv49NiRYE+Cj20bM6NDIJPh+Cof+nuJfkS6iu/6JocHjz4xN7Dg4dgk2uArGlOpNc3jyym4ZtHn4R65+vCOdEgNr1xH4BwB9dxv+FSHB1lUovhdOXHytWB46USxrBmAPnSxWNnQy6k4szPfaHc+0+f6dQ9x23+4ksML0B76xcT2OUmaB/DNvlxa7Otl05xr1jC4TMhgCW9d2T8OJ850EVpLOFch7/hniYQTpRKlWA772xS3UFjXBMO8Y1+S8LIRvX+nxvSNInzht5prxC+I6UC5SBuCJX73Fzj51HdcqEnKed8ymjYRf345tEfhwUsDbvDdB+FZbzlUihm5wQfKdeaM1zoxWCHpfiSLP6Due82Er02qOnUp+mlmjwST+jtiR5Cng7AdBjef7bSsPDziLEvkAr8Eo+tgDbTctcx5Ak7rG67nhW91KeigRj45M2OlrZysVeZ0O3Krcd9oxrxZN9qiNugTWbGlnOwLP2KOLZ70RdrdjXFWaBc4W6YNyXzv7ceTJgk8G44fZnnaMq0oDGJvvmtLmkXb2GW4UZj7yHkc+bn3blHb7nmng0jfmO9i0EdYEF/I72azsh2FzMJm+ud5b5fJnX5opHihUa58rLNTugP4MzhAcElhkLjUrC1bcjudwkzxbWojonDPm8Vff7R/oztYPjV8+vW9w46O4RsyQwadg+sQB71aVvLknPiZe3Hvq3NfloI6AKsAEKC1YmhyPQoBr4E9v2uNXcMucMe6hsasP/OH85KXxyuK3tvV0vXzdUem4zvabg23M02OFwwfHCruRg3LnIEALUlu1YGkEK0WcJLM6QFrCo05PzNey3/3P+/+YnZ3Nc8OCm6mjBbk1bPvLaSHfja+ixwQAFNA4D4I4NSKlCSjl0TH70cpQFhtQsIlTJGgdn69nnv1v9RnXuPrNTybe58uNZtszlWpupJycK/8a+a2bKzImwKwwaGnglqzORREnTwtwqtIVUp4XCrNfc3vxeamR1+jgm3J9rHAZnbdL8/LZRoCatxpJG1mNHmyhKA872reRFaDCkOahnmhVwDBRqW108XHNH4Dkj0dlqdFYg6Xvp+xyCj6qh9NApU9FEcD0RhT9AigV8Yg3STOdC/VlFeuZqzWz7s6eXDk+baDoteIsxUdF8TIeAMtf2SCp0RUVApwgFAhp1kHbStRlQvliOi9ooiSS5UCq47ojPbkLcdrA4NGZK3Cg+EPh/5QPrFgeIhlVbgHqcltwBGWBxatAPEvoJGhtuaAlskgTd1//5t+mwUPE7HvjjQ1Pj42Xz1YqJwDoz6g/R92DuhN1M2o3KtMrE1X79tubBqkAiIpa0cgmZIc1iWRCT3KamBS48otz0Sa2dGgw5sn33zn27ERhl8HljCeOGuNUUjW1yJ3QpE9sAgZTki7JWCJLERgVHvaF39rgmIBJTAHnkHYivbF+OhTROEckUva8/voFRHpHnP8tIJWRT63kU0UYizE0KcVL5khnIZ+NeDwm3eoiMcUj/CSQmuKJ9NjlNkcffPDeff39xyy4pNVeMlbwBCeVelloQCqdsVVmYFbH8UpE/GkHFaDqtLp0nsytwK1ebePn85emdh+ennrqRLGEVTDd+E3dgzCkiQD/BIg1QlBRnxoi8IlRzpGHTBEAsgkfO0tBpUEKD3Uy5SKbiS2xS83LK8hT98Wpqa6q5/VVa96wCRtfxQfNj49OFweOTM1GABV4HPFowyr4pcDpj65YyjmAThyN6DZ4xjSWDb6Ty4cKM6VfvnmxV6Oaiji7AlBBfmJkhTHFR1mhScRFUS7jVeKc7wTm09L7fO9lGuIJwojHIKFoyQWNYMhHA7YvAxIon0RddDBJUnw7810f33Lwj6zPP5nzsU1a8lQdElzJA4DUIaKlBAES9FKg6iEd0koFewf7nrvl4HuyzpnRu7eckhePjaRETCOpUVSwFkzSJr/VEHDMC6eSvjEDXdnST0Y2/u6Wg2dUfrR90xdGd2w+LjYj4KSnlz2OrqVzum3EU8Ch6747uib/tnv4frxMA6zPypWxxcXhly6Vf4Vr8kMfVWp3wdI6EzgZGMY3bIgqrQJgurAnzuKJPxzQ+B8i5xq+X2f7Ms65XXfl/vjNgb4XVMCY/wFmxXtS9siywwAAAABJRU5ErkJggg\u003d\u003d"
  },
  "description": Kapchura is an intelligent B2B sales marketing solution that personalizes the lead generation process while maximizing the potential for successful customer engagements.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "scriptUrl",
    "displayName": "SA script URL",
    "simpleValueType": true,
    "help": "Widget script provided by SparkAmplify/Kapchura",
    "valueValidators": [
      {
        "type": "REGEX",
        "args": [
          "\\bhttps:\\/\\/storage\\.googleapis\\.com\\/(sa\\-widget\\/customer\\-script\\.js\\b|staging\\-sparkamplify\\-dist\\/widget\\/customer\\-script\\.js\\b|sparkamplify\\-dist\\/widget\\/customer\\-script\\.js\\b)"
        ]
      }
    ]
  },
  {
    "type": "CHECKBOX",
    "name": "bebug",
    "checkboxText": "Log debug messages to console",
    "simpleValueType": true
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Require the necessary APIs
const logToConsole = require('logToConsole');
const injectScript = require('injectScript');
const queryPermission = require('queryPermission');

// Get the URL the user input into the text field
const url = data.scriptUrl;

// If the user chose to log debug output, initialize the logging method
const log = data.debug ? logToConsole : (() => {});

log('Conductrics: Loading script from ' + url);

// If the script loaded successfully, log a message and signal success
const onSuccess = () => {
  log('Conductrics: Script loaded successfully.');
  data.gtmOnSuccess();
};

// If the script fails to load, log a message and signal failure
const onFailure = () => {
  log('Conductrics: Script load failed.');
  data.gtmOnFailure();
};

// If the URL input by the user matches the permissions set for the template,
// inject the script with the onSuccess and onFailure methods as callbacks.
if (queryPermission('inject_script', url)) {
  injectScript(url, onSuccess, onFailure);
} else {
  log('Conductrics: Script load failed due to permissions mismatch.');
  data.gtmOnFailure();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://storage.googleapis.com/sa-widget/customer-script.js"
              },
              {
                "type": 1,
                "string": "https://storage.googleapis.com/staging-sparkamplify-dist/widget/customer-script.js"
              },
              {
                "type": 1,
                "string": "https://storage.googleapis.com/sparkamplify-dist/widget/customer-script.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Untitled test 1
  code: |-
    const mockData = {
      // Mocked field values
      scriptUrl: 'https://storage.googleapis.com/sa-widget/customer-script.js',
      debug: true,
    };

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    // assertApi('gtmOnSuccess').wasCalled();


___NOTES___

Created on 3/10/2022, 9:46:49 AM


